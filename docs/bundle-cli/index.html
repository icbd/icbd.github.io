<!DOCTYPE html>
<html>
  <head>
  <title>Ruby Bundler – CBD Blog – 好记性不如烂笔头,站在岸上学不会游泳</title>
      <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="https://bundler.io

最常用的命令是 bundle install 和 bundle exec, 最近遇到了相关问题正好做个整理.

首先需要澄清的是, gem bundle bundler 和 rubygems 的关系.

MacOC 随系统默认安装了以下的命令:


  
    
      command
      version
    
  
  
    
      /usr/bin/ruby
      2.6.3
    
    
      /usr/bin/gem
      3.0.3
    
    
      /usr/bin/bundle
      1.17.2
    
    
      /usr/bin/bundler
      1.17.2
    
  


/usr/bin/ruby 是个二进制文件, 其他几个都是可读的 Ruby 脚本.

gem 用来安装和管理单个 Gem 包, 我们暂且不表.

bundler 其实是 bundle 的别名:


  bundler/exe/bundler


#!/usr/bin/env ruby
# frozen_string_literal: true

load File.expand_path("../bundle", __FILE__)



没考证过为什么需要这样的 alias, 我的猜测是 bundle 和 bundler 都是单词, 为了不让大家费神记住哪个是正确的命令, 就干脆都实现了, 喜欢哪个用哪个.

大家当然都用短的, 所以后面也就叫它 bundle .

但看起来 bundler 才是更正式的名字, bundle 本身也是一个 gem, 它的名字是 bundler.

默认安装的 bundle 是 1.x 的版本, 目前主流已经升级到 2.x , 需要用 gem 安装最新的包:

gem install bundler


bundle 原来的 repository 是 https://github.com/rubygems/bundler, 后来 bundle 被收入 rubygems 统一管理, 最新的 repository 是 https://github.com/rubygems/rubygems.

rubygems 通常指的是 https://rubygems.org/, 他是一个中心化的 Gem 托管服务.

bundle 和 rubygems 都是社区贡献被官方吸纳的例子.

Basic flow

以 debug_bundle 项目为例, 它的逻辑代码只有一个 main.rb 文件:

(从 /usr/bin/bundle 抄来的)

#!/usr/bin/env ruby

require 'rubygems'
require 'byebug'

byebug
load Gem.activate_bin_path('bundler', 'bundle', "&gt;= 0.a")


rubygems 不需要额外安装, 已经包含在 Ruby 标准库中了. byebug 是需要安装的第三方库.

初始化 bundle:

bundle init


这个命令创建出 Gemfile 和 Gemfile.lock .

把 gem "byebug" 添加到 Gemfile 文件末尾 .

安装依赖:

bundle


bundle install 可以简写为 bundle.

这个命令安装 Gemfile 中列出的所有依赖, 并更新 Gemfile.lock 文件.

Reference More: https://bundler.io/v2.2/guides/using_bundler_in_applications.html

安装新的依赖库

以 byebug 为例, 当前最新的几个版本为:

11.1.3 - April 23, 2020 (82.5 KB)
11.1.2 - April 17, 2020 (82.5 KB)
11.1.1 - January 24, 2020 (82.5 KB)
11.1.0 - January 19, 2020 (82.0 KB)
11.0.1 - March 18, 2019 (82.0 KB)
11.0.0 - February 15, 2019 (81.5 KB)
10.0.2 - March 30, 2018 (80.0 KB)
10.0.1 - March 21, 2018 (80.0 KB)
10.0.0 - January 26, 2018 (80.0 KB)


列举本机某个 Gem 的所有版本:

gem list byebug


*** LOCAL GEMS ***

byebug (11.1.3, 11.1.2, 11.1.1, 11.1.0, 11.0.1, 11.0.0, 10.0.2, 10.0.1, 10.0.0, 9.0.5)



  
    
      例子
      解释
      installed version
    
  
  
    
      gem “byebug”
      安装最新版
      11.1.3
    
    
      gem “byebug”, “11.1.1”
      指定版本
      11.1.1
    
    
      gem “byebug”, “11.1”
      指定版本, 小版本缺失时补零
      11.1.0
    
    
      gem “byebug”, “11”
      指定版本, 小版本缺失时补零
      11.0.0
    
    
      gem ‘byebug’, ‘~&gt; 10.0.1’
      大于等于 10.0.1 , 并且 小于 10.1.0 , 使用符合条件的较新版
      10.0.2
    
    
      gem ‘byebug’, ‘~&gt; 11.0’
      大于等于 11.0.0 , 并且 小于 12.0.0, 使用符合条件的较新版
      11.1.3
    
    
      gem ‘byebug’, ‘~&gt; 11.0’, ‘&lt; 11.1.3’
      在 ~&gt; 11.0 的基础上, 并且小于 11.1.3
      11.1.2
    
    
      gem ‘byebug’, ‘~&gt; 11.0’, ‘&gt;= 11.1.1’
      在 ~&gt; 11.0 的基础上, 并且大于等于 11.1.1
      11.1.3
    
  


在 Gemfile 中声明好各个 Gem 的版本后, 使用 bundle install 就能自动安装指定版本的依赖, 同时更新 Gemfile.lock 文件.

根据 Gemfile.lock 安装项目依赖

clone 一个项目之后, 首先需要安装该项目的依赖. 根据规范, repository 中应该存在 Gemfile.lock 文件.

那么 bundle install 会根据 lock 文件中声明的具体版本来安装依赖.

这里有一个隐含的前提, Gemfile 的声明跟 lock 文件是匹配的 (我们可以信任之前的程序员已经处理好了).

依赖计算

依赖计算是 bundle 最核心的功能.

还是看一个具体的例子: gem 'actionpack'

Gemfile.lock 文件的内容为:

GEM
  remote: https://rubygems.org/
  specs:
    abstract (1.0.0)
    actionpack (3.0.9)
      activemodel (= 3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      erubis (~&gt; 2.6.6)
      i18n (~&gt; 0.5.0)
      rack (~&gt; 1.2.1)
      rack-mount (~&gt; 0.6.14)
      rack-test (~&gt; 0.5.7)
      tzinfo (~&gt; 0.3.23)
    activemodel (3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      i18n (~&gt; 0.5.0)
    activesupport (3.0.9)
    builder (2.1.2)
    erubis (2.6.6)
      abstract (&gt;= 1.0.0)
    i18n (0.5.4)
    rack (1.2.8)
    rack-mount (0.6.14)
      rack (&gt;= 1.0.0)
    rack-test (0.5.7)
      rack (&gt;= 1.0)
    tzinfo (0.3.60)

PLATFORMS
  x86_64-darwin-20

DEPENDENCIES
  actionpack

BUNDLED WITH
   2.2.26



可以看到 rack 最终安装的版本是 rack (1.2.8), 但是其他几个组件都声明了不同的 rack 依赖:


  rack (~&gt; 1.2.1)
  rack (&gt;= 1.0.0)
  rack (&gt;= 1.0)


bundle 帮我们做的就是综合所有依赖的声明, 计算出一个最合适的兼容版本, 最后把这个版本记录在 lock 文件中.

那么其他人就可以跳过计算步骤, 直接根据 lock 文件来安装合适的版本.

遇到冲突时尝试使用 bundle update gemA gemB, 如果自动升级解决不了就需要人工接入选择了.

bundle update 会更新所有 gem.

By the way, npm 就不解决版本冲突, 把所有版本都保存下来. 这也就是它会占用超多的磁盘空间的原因.

bundle exec

使用 bundle 中声明的命令版本来执行, 比如 bundle exec rails, bundle exec rspec.

在代码中更精确地控制 bundle , 比如分组:

require 'bundler/setup'
Bundler.require(:default, :development)


看看 Rails 是怎么做的, 以下代码来自项目脚手架:


  
    启动文件 bin/rails

     #!/usr/bin/env ruby
 load File.expand_path("spring", __dir__)
 APP_PATH = File.expand_path('../config/application', __dir__)
 require_relative "../config/boot"
 require "rails/commands"

    
  
  
    config/boot.rb

     ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../Gemfile', __dir__)

 require "bundler/setup" # Set up gems listed in the Gemfile.
 require "bootsnap/setup" # Speed up boot time by caching expensive operations.

    
  
  
    config/application.rb

     require_relative "boot"

 require "rails"
 # Pick the frameworks you want:
 require "active_model/railtie"
 require "active_job/railtie"
 require "active_record/railtie"
 require "active_storage/engine"
 require "action_controller/railtie"
 require "action_mailer/railtie"
 require "action_mailbox/engine"
 require "action_text/engine"
 require "action_view/railtie"
 require "action_cable/engine"
 # require "sprockets/railtie"
 require "rails/test_unit/railtie"

 # Require the gems listed in Gemfile, including any gems
 # you've limited to :test, :development, or :production.
 Bundler.require(*Rails.groups)

 module Demoapp
   class Application &lt; Rails::Application
     config.load_defaults 6.1
     config.api_only = true
   end
 end

    
  


其他例子

修改rubygems源

bundle config mirror.https://rubygems.org https://gems.ruby-china.com


https://gems.ruby-china.com/

安装本地 Gem

gem "tacokit", path: "/path/to/tacokit"


https://rossta.net/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html

通过 git repo 安装

gem 'rack', git: 'https://github.com/rack/rack'


gem 位于子目录下:

gem 'cf-copilot', git: 'https://github.com/cloudfoundry/copilot', glob: 'sdk/ruby/*.gemspec'


指定分支, tag, hash:

gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', ref: '0bd839d'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', tag: '2.0.1'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', branch: 'rack-1.5'

" />
    <meta property="og:description" content="https://bundler.io

最常用的命令是 bundle install 和 bundle exec, 最近遇到了相关问题正好做个整理.

首先需要澄清的是, gem bundle bundler 和 rubygems 的关系.

MacOC 随系统默认安装了以下的命令:


  
    
      command
      version
    
  
  
    
      /usr/bin/ruby
      2.6.3
    
    
      /usr/bin/gem
      3.0.3
    
    
      /usr/bin/bundle
      1.17.2
    
    
      /usr/bin/bundler
      1.17.2
    
  


/usr/bin/ruby 是个二进制文件, 其他几个都是可读的 Ruby 脚本.

gem 用来安装和管理单个 Gem 包, 我们暂且不表.

bundler 其实是 bundle 的别名:


  bundler/exe/bundler


#!/usr/bin/env ruby
# frozen_string_literal: true

load File.expand_path("../bundle", __FILE__)



没考证过为什么需要这样的 alias, 我的猜测是 bundle 和 bundler 都是单词, 为了不让大家费神记住哪个是正确的命令, 就干脆都实现了, 喜欢哪个用哪个.

大家当然都用短的, 所以后面也就叫它 bundle .

但看起来 bundler 才是更正式的名字, bundle 本身也是一个 gem, 它的名字是 bundler.

默认安装的 bundle 是 1.x 的版本, 目前主流已经升级到 2.x , 需要用 gem 安装最新的包:

gem install bundler


bundle 原来的 repository 是 https://github.com/rubygems/bundler, 后来 bundle 被收入 rubygems 统一管理, 最新的 repository 是 https://github.com/rubygems/rubygems.

rubygems 通常指的是 https://rubygems.org/, 他是一个中心化的 Gem 托管服务.

bundle 和 rubygems 都是社区贡献被官方吸纳的例子.

Basic flow

以 debug_bundle 项目为例, 它的逻辑代码只有一个 main.rb 文件:

(从 /usr/bin/bundle 抄来的)

#!/usr/bin/env ruby

require 'rubygems'
require 'byebug'

byebug
load Gem.activate_bin_path('bundler', 'bundle', "&gt;= 0.a")


rubygems 不需要额外安装, 已经包含在 Ruby 标准库中了. byebug 是需要安装的第三方库.

初始化 bundle:

bundle init


这个命令创建出 Gemfile 和 Gemfile.lock .

把 gem "byebug" 添加到 Gemfile 文件末尾 .

安装依赖:

bundle


bundle install 可以简写为 bundle.

这个命令安装 Gemfile 中列出的所有依赖, 并更新 Gemfile.lock 文件.

Reference More: https://bundler.io/v2.2/guides/using_bundler_in_applications.html

安装新的依赖库

以 byebug 为例, 当前最新的几个版本为:

11.1.3 - April 23, 2020 (82.5 KB)
11.1.2 - April 17, 2020 (82.5 KB)
11.1.1 - January 24, 2020 (82.5 KB)
11.1.0 - January 19, 2020 (82.0 KB)
11.0.1 - March 18, 2019 (82.0 KB)
11.0.0 - February 15, 2019 (81.5 KB)
10.0.2 - March 30, 2018 (80.0 KB)
10.0.1 - March 21, 2018 (80.0 KB)
10.0.0 - January 26, 2018 (80.0 KB)


列举本机某个 Gem 的所有版本:

gem list byebug


*** LOCAL GEMS ***

byebug (11.1.3, 11.1.2, 11.1.1, 11.1.0, 11.0.1, 11.0.0, 10.0.2, 10.0.1, 10.0.0, 9.0.5)



  
    
      例子
      解释
      installed version
    
  
  
    
      gem “byebug”
      安装最新版
      11.1.3
    
    
      gem “byebug”, “11.1.1”
      指定版本
      11.1.1
    
    
      gem “byebug”, “11.1”
      指定版本, 小版本缺失时补零
      11.1.0
    
    
      gem “byebug”, “11”
      指定版本, 小版本缺失时补零
      11.0.0
    
    
      gem ‘byebug’, ‘~&gt; 10.0.1’
      大于等于 10.0.1 , 并且 小于 10.1.0 , 使用符合条件的较新版
      10.0.2
    
    
      gem ‘byebug’, ‘~&gt; 11.0’
      大于等于 11.0.0 , 并且 小于 12.0.0, 使用符合条件的较新版
      11.1.3
    
    
      gem ‘byebug’, ‘~&gt; 11.0’, ‘&lt; 11.1.3’
      在 ~&gt; 11.0 的基础上, 并且小于 11.1.3
      11.1.2
    
    
      gem ‘byebug’, ‘~&gt; 11.0’, ‘&gt;= 11.1.1’
      在 ~&gt; 11.0 的基础上, 并且大于等于 11.1.1
      11.1.3
    
  


在 Gemfile 中声明好各个 Gem 的版本后, 使用 bundle install 就能自动安装指定版本的依赖, 同时更新 Gemfile.lock 文件.

根据 Gemfile.lock 安装项目依赖

clone 一个项目之后, 首先需要安装该项目的依赖. 根据规范, repository 中应该存在 Gemfile.lock 文件.

那么 bundle install 会根据 lock 文件中声明的具体版本来安装依赖.

这里有一个隐含的前提, Gemfile 的声明跟 lock 文件是匹配的 (我们可以信任之前的程序员已经处理好了).

依赖计算

依赖计算是 bundle 最核心的功能.

还是看一个具体的例子: gem 'actionpack'

Gemfile.lock 文件的内容为:

GEM
  remote: https://rubygems.org/
  specs:
    abstract (1.0.0)
    actionpack (3.0.9)
      activemodel (= 3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      erubis (~&gt; 2.6.6)
      i18n (~&gt; 0.5.0)
      rack (~&gt; 1.2.1)
      rack-mount (~&gt; 0.6.14)
      rack-test (~&gt; 0.5.7)
      tzinfo (~&gt; 0.3.23)
    activemodel (3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      i18n (~&gt; 0.5.0)
    activesupport (3.0.9)
    builder (2.1.2)
    erubis (2.6.6)
      abstract (&gt;= 1.0.0)
    i18n (0.5.4)
    rack (1.2.8)
    rack-mount (0.6.14)
      rack (&gt;= 1.0.0)
    rack-test (0.5.7)
      rack (&gt;= 1.0)
    tzinfo (0.3.60)

PLATFORMS
  x86_64-darwin-20

DEPENDENCIES
  actionpack

BUNDLED WITH
   2.2.26



可以看到 rack 最终安装的版本是 rack (1.2.8), 但是其他几个组件都声明了不同的 rack 依赖:


  rack (~&gt; 1.2.1)
  rack (&gt;= 1.0.0)
  rack (&gt;= 1.0)


bundle 帮我们做的就是综合所有依赖的声明, 计算出一个最合适的兼容版本, 最后把这个版本记录在 lock 文件中.

那么其他人就可以跳过计算步骤, 直接根据 lock 文件来安装合适的版本.

遇到冲突时尝试使用 bundle update gemA gemB, 如果自动升级解决不了就需要人工接入选择了.

bundle update 会更新所有 gem.

By the way, npm 就不解决版本冲突, 把所有版本都保存下来. 这也就是它会占用超多的磁盘空间的原因.

bundle exec

使用 bundle 中声明的命令版本来执行, 比如 bundle exec rails, bundle exec rspec.

在代码中更精确地控制 bundle , 比如分组:

require 'bundler/setup'
Bundler.require(:default, :development)


看看 Rails 是怎么做的, 以下代码来自项目脚手架:


  
    启动文件 bin/rails

     #!/usr/bin/env ruby
 load File.expand_path("spring", __dir__)
 APP_PATH = File.expand_path('../config/application', __dir__)
 require_relative "../config/boot"
 require "rails/commands"

    
  
  
    config/boot.rb

     ENV['BUNDLE_GEMFILE'] ||= File.expand_path('../Gemfile', __dir__)

 require "bundler/setup" # Set up gems listed in the Gemfile.
 require "bootsnap/setup" # Speed up boot time by caching expensive operations.

    
  
  
    config/application.rb

     require_relative "boot"

 require "rails"
 # Pick the frameworks you want:
 require "active_model/railtie"
 require "active_job/railtie"
 require "active_record/railtie"
 require "active_storage/engine"
 require "action_controller/railtie"
 require "action_mailer/railtie"
 require "action_mailbox/engine"
 require "action_text/engine"
 require "action_view/railtie"
 require "action_cable/engine"
 # require "sprockets/railtie"
 require "rails/test_unit/railtie"

 # Require the gems listed in Gemfile, including any gems
 # you've limited to :test, :development, or :production.
 Bundler.require(*Rails.groups)

 module Demoapp
   class Application &lt; Rails::Application
     config.load_defaults 6.1
     config.api_only = true
   end
 end

    
  


其他例子

修改rubygems源

bundle config mirror.https://rubygems.org https://gems.ruby-china.com


https://gems.ruby-china.com/

安装本地 Gem

gem "tacokit", path: "/path/to/tacokit"


https://rossta.net/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html

通过 git repo 安装

gem 'rack', git: 'https://github.com/rack/rack'


gem 位于子目录下:

gem 'cf-copilot', git: 'https://github.com/cloudfoundry/copilot', glob: 'sdk/ruby/*.gemspec'


指定分支, tag, hash:

gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', ref: '0bd839d'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', tag: '2.0.1'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', branch: 'rack-1.5'

" />
    
    <meta name="author" content="CBD Blog" />

    
    <meta property="og:title" content="Ruby Bundler" />
    <meta property="twitter:title" content="Ruby Bundler" />
    
  <link rel="stylesheet" type="text/css" href="/style.css" />
  <link rel="alternate" type="application/rss+xml" title="CBD Blog - 好记性不如烂笔头,站在岸上学不会游泳" href="/feed.xml" />
  <link rel="shortcut icon" href="/images/avatar.jpg">
<!--  <script src="https://lib.baomitu.com/gitalk/1.6.2/gitalk.min.js"></script>-->
  <script src="https://lib.baomitu.com/feather-icons/latest/feather.min.js"></script>
  <script type="text/javascript" async src="https://lib.baomitu.com/mathjax/2.7.7/MathJax.js?...">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
  <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?9dfbb5850b35a184a60c9a4a1b08d7e3";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

  <meta name="google-site-verification" content="ZqVpjmLHnwuJ0qbh4QrpcofglQe6XEjjF7X1AB7yXus" />
</head>

  <body>
    <div class="wrapper-sidebar">
  <header class="sidebar clearfix">
    <div class="site-info">
      
        <a href="/" class="site-avatar"><img src="/images/avatar.jpg" /></a>
       
      <h1 class="site-name"><a href="/">CBD Blog</a></h1>
      <p class="site-description">好记性不如烂笔头,站在岸上学不会游泳</p>
    </div>
  </header>

  <div class="navlist">
    <nav>
      
      
      <a href="/">首页</a>
      
      
      
      <a href="/archive">归档</a>
      
      
      
      <a href="/about">关于</a>
      
      
    </nav>
  </div>

  <div class="wrapper-footer-desktop">
    <footer class="footer">
      <!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  
  
  

  

  
  <li><a href="mailto:wwwicbd@gmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/icbd" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  
  <li><a href="/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://www.twitter.com/CbdFocus" class="icon-26 twitter" title="Twitter"><svg viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li>
  

  

</ul>



<p>Copyright (c) 2020 CBD Blog</p>

    </footer>
  </div>
</div>

    
      <aside class="toc">
        <ul>
  <li><a href="#">Ruby Bundler</a>
    <ul>
      <li><a href="#basic-flow">Basic flow</a></li>
      <li><a href="#安装新的依赖库">安装新的依赖库</a></li>
      <li><a href="#根据-gemfilelock-安装项目依赖">根据 Gemfile.lock 安装项目依赖</a></li>
      <li><a href="#依赖计算">依赖计算</a></li>
      <li><a href="#bundle-exec">bundle exec</a></li>
      <li><a href="#其他例子">其他例子</a>
        <ul>
          <li><a href="#修改rubygems源">修改rubygems源</a></li>
          <li><a href="#安装本地-gem">安装本地 Gem</a></li>
          <li><a href="#通过-git-repo-安装">通过 git repo 安装</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
      </aside>
    

    <div id="main" role="main" class="wrapper-content">
      <div class="container">
        <article class="posts">
  <h1>Ruby Bundler</h1>

  <div clsss="meta">
    <span class="author">
      
    </span>

    <span class="date">
      2021-09-01
    </span>

    <ul class="tag">
      
      <li>
        <a href="https://icbd.github.io/tags#Ruby">
          Ruby
        </a>
      </li>
      
      <li>
        <a href="https://icbd.github.io/tags#bundle">
          bundle
        </a>
      </li>
      
    </ul>
  </div>

  <div class="entry">
    <p><a href="https://bundler.io">https://bundler.io</a></p>

<p>最常用的命令是 <code class="language-plaintext highlighter-rouge">bundle install</code> 和 <code class="language-plaintext highlighter-rouge">bundle exec</code>, 最近遇到了相关问题正好做个整理.</p>

<p>首先需要澄清的是, <code class="language-plaintext highlighter-rouge">gem</code> <code class="language-plaintext highlighter-rouge">bundle</code> <code class="language-plaintext highlighter-rouge">bundler</code> 和 <code class="language-plaintext highlighter-rouge">rubygems</code> 的关系.</p>

<p>MacOC 随系统默认安装了以下的命令:</p>

<table>
  <thead>
    <tr>
      <th>command</th>
      <th>version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/usr/bin/ruby</code></td>
      <td>2.6.3</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/usr/bin/gem</code></td>
      <td>3.0.3</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/usr/bin/bundle</code></td>
      <td>1.17.2</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">/usr/bin/bundler</code></td>
      <td>1.17.2</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">/usr/bin/ruby</code> 是个二进制文件, 其他几个都是可读的 Ruby 脚本.</p>

<p>gem 用来安装和管理单个 Gem 包, 我们暂且不表.</p>

<p>bundler 其实是 bundle 的别名:</p>

<blockquote>
  <p>bundler/exe/bundler</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>
<span class="c1"># frozen_string_literal: true</span>

<span class="nb">load</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"../bundle"</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>

</code></pre></div></div>

<p>没考证过为什么需要这样的 alias, 我的猜测是 bundle 和 bundler 都是单词, 为了不让大家费神记住哪个是正确的命令, 就干脆都实现了, 喜欢哪个用哪个.</p>

<p>大家当然都用短的, 所以后面也就叫它 <code class="language-plaintext highlighter-rouge">bundle</code> .</p>

<p>但看起来 <code class="language-plaintext highlighter-rouge">bundler</code> 才是更正式的名字, bundle 本身也是一个 gem, 它的名字是 <code class="language-plaintext highlighter-rouge">bundler</code>.</p>

<p>默认安装的 bundle 是 1.x 的版本, 目前主流已经升级到 2.x , 需要用 gem 安装最新的包:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem <span class="nb">install </span>bundler
</code></pre></div></div>

<p>bundle 原来的 repository 是 <a href="https://github.com/rubygems/bundler">https://github.com/rubygems/bundler</a>, 后来 bundle 被收入 rubygems 统一管理, 最新的 repository 是 <a href="https://github.com/rubygems/rubygems">https://github.com/rubygems/rubygems</a>.</p>

<p>rubygems 通常指的是 <a href="https://rubygems.org/">https://rubygems.org/</a>, 他是一个中心化的 Gem 托管服务.</p>

<p>bundle 和 rubygems 都是社区贡献被官方吸纳的例子.</p>

<h2 id="basic-flow">Basic flow</h2>

<p>以 <code class="language-plaintext highlighter-rouge">debug_bundle</code> 项目为例, 它的逻辑代码只有一个 <code class="language-plaintext highlighter-rouge">main.rb</code> 文件:</p>

<p>(从 <code class="language-plaintext highlighter-rouge">/usr/bin/bundle</code> 抄来的)</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>

<span class="nb">require</span> <span class="s1">'rubygems'</span>
<span class="nb">require</span> <span class="s1">'byebug'</span>

<span class="n">byebug</span>
<span class="nb">load</span> <span class="no">Gem</span><span class="p">.</span><span class="nf">activate_bin_path</span><span class="p">(</span><span class="s1">'bundler'</span><span class="p">,</span> <span class="s1">'bundle'</span><span class="p">,</span> <span class="s2">"&gt;= 0.a"</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">rubygems</code> 不需要额外安装, 已经包含在 Ruby 标准库中了. <code class="language-plaintext highlighter-rouge">byebug</code> 是需要安装的第三方库.</p>

<p>初始化 bundle:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle init
</code></pre></div></div>

<p>这个命令创建出 <code class="language-plaintext highlighter-rouge">Gemfile</code> 和 <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> .</p>

<p>把 <code class="language-plaintext highlighter-rouge">gem "byebug"</code> 添加到 <code class="language-plaintext highlighter-rouge">Gemfile</code> 文件末尾 .</p>

<p>安装依赖:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">bundle install</code> 可以简写为 <code class="language-plaintext highlighter-rouge">bundle</code>.</p>

<p>这个命令安装 Gemfile 中列出的所有依赖, 并更新 <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> 文件.</p>

<p>Reference More: <a href="https://bundler.io/v2.2/guides/using_bundler_in_applications.html">https://bundler.io/v2.2/guides/using_bundler_in_applications.html</a></p>

<h2 id="安装新的依赖库">安装新的依赖库</h2>

<p>以 <code class="language-plaintext highlighter-rouge">byebug</code> 为例, 当前最新的几个版本为:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>11.1.3 - April 23, 2020 (82.5 KB)
11.1.2 - April 17, 2020 (82.5 KB)
11.1.1 - January 24, 2020 (82.5 KB)
11.1.0 - January 19, 2020 (82.0 KB)
11.0.1 - March 18, 2019 (82.0 KB)
11.0.0 - February 15, 2019 (81.5 KB)
10.0.2 - March 30, 2018 (80.0 KB)
10.0.1 - March 21, 2018 (80.0 KB)
10.0.0 - January 26, 2018 (80.0 KB)
</code></pre></div></div>

<p>列举本机某个 Gem 的所有版本:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem list byebug
</code></pre></div></div>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*** LOCAL GEMS ***

byebug (11.1.3, 11.1.2, 11.1.1, 11.1.0, 11.0.1, 11.0.0, 10.0.2, 10.0.1, 10.0.0, 9.0.5)
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th>例子</th>
      <th>解释</th>
      <th>installed version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>gem “byebug”</td>
      <td>安装最新版</td>
      <td>11.1.3</td>
    </tr>
    <tr>
      <td>gem “byebug”, “11.1.1”</td>
      <td>指定版本</td>
      <td>11.1.1</td>
    </tr>
    <tr>
      <td>gem “byebug”, “11.1”</td>
      <td>指定版本, 小版本缺失时补零</td>
      <td>11.1.0</td>
    </tr>
    <tr>
      <td>gem “byebug”, “11”</td>
      <td>指定版本, 小版本缺失时补零</td>
      <td>11.0.0</td>
    </tr>
    <tr>
      <td>gem ‘byebug’, ‘~&gt; 10.0.1’</td>
      <td>大于等于 10.0.1 , 并且 小于 10.1.0 , 使用符合条件的较新版</td>
      <td>10.0.2</td>
    </tr>
    <tr>
      <td>gem ‘byebug’, ‘~&gt; 11.0’</td>
      <td>大于等于 11.0.0 , 并且 小于 12.0.0, 使用符合条件的较新版</td>
      <td>11.1.3</td>
    </tr>
    <tr>
      <td>gem ‘byebug’, ‘~&gt; 11.0’, ‘&lt; 11.1.3’</td>
      <td>在 <code class="language-plaintext highlighter-rouge">~&gt; 11.0</code> 的基础上, 并且小于 11.1.3</td>
      <td>11.1.2</td>
    </tr>
    <tr>
      <td>gem ‘byebug’, ‘~&gt; 11.0’, ‘&gt;= 11.1.1’</td>
      <td>在 <code class="language-plaintext highlighter-rouge">~&gt; 11.0</code> 的基础上, 并且大于等于 11.1.1</td>
      <td>11.1.3</td>
    </tr>
  </tbody>
</table>

<p>在 Gemfile 中声明好各个 Gem 的版本后, 使用 <code class="language-plaintext highlighter-rouge">bundle install</code> 就能自动安装指定版本的依赖, 同时更新 <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> 文件.</p>

<h2 id="根据-gemfilelock-安装项目依赖">根据 Gemfile.lock 安装项目依赖</h2>

<p>clone 一个项目之后, 首先需要安装该项目的依赖. 根据规范, repository 中应该存在 <code class="language-plaintext highlighter-rouge">Gemfile.lock</code> 文件.</p>

<p>那么 <code class="language-plaintext highlighter-rouge">bundle install</code> 会根据 lock 文件中声明的具体版本来安装依赖.</p>

<p>这里有一个隐含的前提, Gemfile 的声明跟 lock 文件是匹配的 (我们可以信任之前的程序员已经处理好了).</p>

<h2 id="依赖计算">依赖计算</h2>

<p>依赖计算是 bundle 最核心的功能.</p>

<p>还是看一个具体的例子: <code class="language-plaintext highlighter-rouge">gem 'actionpack'</code></p>

<p>Gemfile.lock 文件的内容为:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GEM
  remote: https://rubygems.org/
  specs:
    abstract (1.0.0)
    actionpack (3.0.9)
      activemodel (= 3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      erubis (~&gt; 2.6.6)
      i18n (~&gt; 0.5.0)
      rack (~&gt; 1.2.1)
      rack-mount (~&gt; 0.6.14)
      rack-test (~&gt; 0.5.7)
      tzinfo (~&gt; 0.3.23)
    activemodel (3.0.9)
      activesupport (= 3.0.9)
      builder (~&gt; 2.1.2)
      i18n (~&gt; 0.5.0)
    activesupport (3.0.9)
    builder (2.1.2)
    erubis (2.6.6)
      abstract (&gt;= 1.0.0)
    i18n (0.5.4)
    rack (1.2.8)
    rack-mount (0.6.14)
      rack (&gt;= 1.0.0)
    rack-test (0.5.7)
      rack (&gt;= 1.0)
    tzinfo (0.3.60)

PLATFORMS
  x86_64-darwin-20

DEPENDENCIES
  actionpack

BUNDLED WITH
   2.2.26

</code></pre></div></div>

<p>可以看到 rack 最终安装的版本是 <code class="language-plaintext highlighter-rouge">rack (1.2.8)</code>, 但是其他几个组件都声明了不同的 rack 依赖:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">rack (~&gt; 1.2.1)</code></li>
  <li><code class="language-plaintext highlighter-rouge">rack (&gt;= 1.0.0)</code></li>
  <li><code class="language-plaintext highlighter-rouge">rack (&gt;= 1.0)</code></li>
</ul>

<p>bundle 帮我们做的就是综合所有依赖的声明, 计算出一个最合适的兼容版本, 最后把这个版本记录在 lock 文件中.</p>

<p>那么其他人就可以跳过计算步骤, 直接根据 lock 文件来安装合适的版本.</p>

<p>遇到冲突时尝试使用 <code class="language-plaintext highlighter-rouge">bundle update gemA gemB</code>, 如果自动升级解决不了就需要人工接入选择了.</p>

<p><code class="language-plaintext highlighter-rouge">bundle update</code> 会更新所有 gem.</p>

<p>By the way, npm 就不解决版本冲突, 把所有版本都保存下来. 这也就是它会占用超多的磁盘空间的原因.</p>

<h2 id="bundle-exec">bundle exec</h2>

<p>使用 bundle 中声明的命令版本来执行, 比如 <code class="language-plaintext highlighter-rouge">bundle exec rails</code>, <code class="language-plaintext highlighter-rouge">bundle exec rspec</code>.</p>

<p>在代码中更精确地控制 bundle , 比如分组:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'bundler/setup'</span>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:default</span><span class="p">,</span> <span class="ss">:development</span><span class="p">)</span>
</code></pre></div></div>

<p>看看 Rails 是怎么做的, 以下代码来自项目脚手架:</p>

<ol>
  <li>
    <p>启动文件 <code class="language-plaintext highlighter-rouge">bin/rails</code></p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">#!/usr/bin/env ruby</span>
 <span class="nb">load</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"spring"</span><span class="p">,</span> <span class="n">__dir__</span><span class="p">)</span>
 <span class="no">APP_PATH</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../config/application'</span><span class="p">,</span> <span class="n">__dir__</span><span class="p">)</span>
 <span class="nb">require_relative</span> <span class="s2">"../config/boot"</span>
 <span class="nb">require</span> <span class="s2">"rails/commands"</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/boot.rb</code></p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="no">ENV</span><span class="p">[</span><span class="s1">'BUNDLE_GEMFILE'</span><span class="p">]</span> <span class="o">||=</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../Gemfile'</span><span class="p">,</span> <span class="n">__dir__</span><span class="p">)</span>

 <span class="nb">require</span> <span class="s2">"bundler/setup"</span> <span class="c1"># Set up gems listed in the Gemfile.</span>
 <span class="nb">require</span> <span class="s2">"bootsnap/setup"</span> <span class="c1"># Speed up boot time by caching expensive operations.</span>

</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">config/application.rb</code></p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nb">require_relative</span> <span class="s2">"boot"</span>

 <span class="nb">require</span> <span class="s2">"rails"</span>
 <span class="c1"># Pick the frameworks you want:</span>
 <span class="nb">require</span> <span class="s2">"active_model/railtie"</span>
 <span class="nb">require</span> <span class="s2">"active_job/railtie"</span>
 <span class="nb">require</span> <span class="s2">"active_record/railtie"</span>
 <span class="nb">require</span> <span class="s2">"active_storage/engine"</span>
 <span class="nb">require</span> <span class="s2">"action_controller/railtie"</span>
 <span class="nb">require</span> <span class="s2">"action_mailer/railtie"</span>
 <span class="nb">require</span> <span class="s2">"action_mailbox/engine"</span>
 <span class="nb">require</span> <span class="s2">"action_text/engine"</span>
 <span class="nb">require</span> <span class="s2">"action_view/railtie"</span>
 <span class="nb">require</span> <span class="s2">"action_cable/engine"</span>
 <span class="c1"># require "sprockets/railtie"</span>
 <span class="nb">require</span> <span class="s2">"rails/test_unit/railtie"</span>

 <span class="c1"># Require the gems listed in Gemfile, including any gems</span>
 <span class="c1"># you've limited to :test, :development, or :production.</span>
 <span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="o">*</span><span class="no">Rails</span><span class="p">.</span><span class="nf">groups</span><span class="p">)</span>

 <span class="k">module</span> <span class="nn">Demoapp</span>
   <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
     <span class="n">config</span><span class="p">.</span><span class="nf">load_defaults</span> <span class="mf">6.1</span>
     <span class="n">config</span><span class="p">.</span><span class="nf">api_only</span> <span class="o">=</span> <span class="kp">true</span>
   <span class="k">end</span>
 <span class="k">end</span>

</code></pre></div>    </div>
  </li>
</ol>

<h2 id="其他例子">其他例子</h2>

<h3 id="修改rubygems源">修改rubygems源</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bundle config mirror.https://rubygems.org https://gems.ruby-china.com
</code></pre></div></div>

<p><a href="https://gems.ruby-china.com/">https://gems.ruby-china.com/</a></p>

<h3 id="安装本地-gem">安装本地 Gem</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem "tacokit", path: "/path/to/tacokit"
</code></pre></div></div>

<p><a href="https://rossta.net/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html">https://rossta.net/blog/how-to-specify-local-ruby-gems-in-your-gemfile.html</a></p>

<h3 id="通过-git-repo-安装">通过 git repo 安装</h3>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'rack', git: 'https://github.com/rack/rack'
</code></pre></div></div>

<p>gem 位于子目录下:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'cf-copilot', git: 'https://github.com/cloudfoundry/copilot', glob: 'sdk/ruby/*.gemspec'
</code></pre></div></div>

<p>指定分支, tag, hash:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', ref: '0bd839d'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', tag: '2.0.1'
gem 'nokogiri', git: 'https://github.com/sparklemotion/nokogiri.git', branch: 'rack-1.5'
</code></pre></div></div>

  </div>

  
  
<script src="https://utteranc.es/client.js"
        repo="icbd/blogs"
        issue-term="pathname"
        label="utteranc"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

  
</article>

<div class="pagination">
  
    <span class="prev" >
      <a href="https://icbd.github.io/pg-foreign-keys/">
        ← 上一篇
      </a>
    </span>
  
  
    <span class="next" >
      <a href="https://icbd.github.io/makefile-basic/">
        下一篇 →
      </a>
    </span>
  
</div>

      </div>
    </div>
  </body>

  
  <script>
    document.getElementById("main").classList.add("withtoc");
  </script>
  

  <div class="wrapper-footer-mobile">
    <footer class="footer">
      <!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  
  
  

  

  
  <li><a href="mailto:wwwicbd@gmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/icbd" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  
  <li><a href="/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://www.twitter.com/CbdFocus" class="icon-26 twitter" title="Twitter"><svg viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li>
  

  

</ul>



<p>Copyright (c) 2020 CBD Blog</p>

    </footer>
</html>
