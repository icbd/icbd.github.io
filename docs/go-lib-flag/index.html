<!DOCTYPE html>
<html>
  <head>
  <title>Go Lib flag – CBD Blog – 好记性不如烂笔头,站在岸上学不会游泳</title>
      <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="flag 是官方提供的命令行参数解析的工具包.

基本用法

package main

import (
	"flag"
	"fmt"
)

var name = flag.String("name", "Default Name", "Name setting")

func main() {
	flag.Parse()
	fmt.Printf("Hello %s\n", *name)
}
// go run main.go -name=John
// go run main.go -name="John smith"


自定义解析器

package main

import (
	"flag"
	"fmt"
	"github.com/spf13/cast"
	"strings"
)

type User struct {
	Name string
	Age  int
}

func (u *User) String() string {
	return fmt.Sprintf("Name:%s, Age:%d\n", u.Name, u.Age)
}

// Set by Bob:12
func (u *User) Set(value string) error {
	splits := strings.Split(value, ":")
	if len(splits) == 2 {
		u.Name = splits[0]
		u.Age = cast.ToInt(splits[1])
		return nil
	}
	return fmt.Errorf("format error")
}

func FlagUser(name string, value string, usage string) *User {
	u := User{}
	_ = u.Set(value) // init default value
	flag.Var(&amp;u, name, usage)
	return &amp;u
}

var u = FlagUser("user", "Default Name:100", "parse User")

func main() {
	flag.Parse()
	fmt.Printf("%T %s\n", u, u)
}
// go run main.go -user=Bob:12



核心方法是 func (f *FlagSet) Var(value Value, name string, usage string), Value 的接口如下所示:

type Value interface {
	String() string
	Set(string) error
}


对于解析参数来说, 我们用不到 String(), 但是在语法上要实现这个接口就要实现 String() 方法.

还需要注意实现 String() 的时候不要直接return fmt.Sprintln(u), 否则会导致方法无限递归而 stack overflow.

FlagUser 参照了 flag 自带方法的风格, 参数依次为 flag值, 默认值, 帮助提示, 最后返回一个自定义类型的指针.

源码解析

在开始读源码之前, 我们先看一下 os.Args 的解析规则, 它会得到一个字符串 slice.

package main

import (
	"fmt"
	"os"
)

func main() {
	for _, s := range os.Args {
		fmt.Println(s)
	}
}


$ go run main.go  --s -s hello -s=hi --s="hello world"


output:

/var/folders/jd/tgbfgqzn3z1c_qmcd0qcmcx80000gn/T/go-build687856139/b001/exe/main
--s
-s
hello
-s=hi
--s=hello world



规则要点如下:


  每个元素都是字符串, 大小写敏感;
  第一个元素为该程序的绝对路径;
  后面的元素依次为空格分隔的参数, 连续空格视作一个分隔;
  引号内的空格不做分隔, 自动脱去引号.


flag 在以上规则的基础上, 衍生出以下规则:


  参数由 - 或 --开始, 用等号或空格分隔键值, --s=1, -s=1, --s 1, -s 1 等效;
  -s -S 为不同的标签;
  对于布尔型的标签, 可以略去值来表示标签为 true: -b, --b;
  ` – ` 后的参数将被忽略;
  不允许重复注册标签.


核心结构体

像 flag 这样先注册再使用的模式(类似路由匹配), 一般会在注册时解析规则, 然后把规则保存到一个集合里, 在使用的时候去集合里匹配规则.

FlagSet 就是这样的一个集合, Flag 是其中的每个元素.

type Flag struct {
	Name     string // 标签名: `-s` 或 `--s` 中 的 `s`
	Usage    string // 用途, 帮助信息.
	Value    Value  // Value 接口: `Set(v string) error` &amp;&amp; `String() string`
	DefValue string // 标签的默认值, 为打印帮助信息所用.
}


type FlagSet struct {
	Usage func()	// 帮助信息的打印函数, 默认为 `defaultUsage()`

	name          string // 当前程序的绝对路径
	parsed        bool // 标记已经执行过解析: `flag.Parse()`
	actual        map[string]*Flag // 由 `os.Args` 解析得到的标签
	formal        map[string]*Flag // 之前注册的标签
	args          []string // 命令行参数列表 (除去程序的绝对路径)
	errorHandling ErrorHandling // 异常处理的方式: 返回 error / 程序 exit / panic
	output        io.Writer // 打印目的地, 默认为 `os.Stderr`
}


注册标签

var CommandLine = NewFlagSet(os.Args[0], ExitOnError)


CommandLine 是 package 级别的, 只会运行一次 NewFlagSet(), 得到的结果指向一个未完全初始化的 FlagSet (map 和 slice 现在还是空).

func (f *FlagSet) Var(value Value, name string, usage string) {
	// Remember the default value as a string; it won't change.
	flag := &amp;Flag{name, usage, value, value.String()}
	_, alreadythere := f.formal[name]
	if alreadythere {
		var msg string
		if f.name == "" {
			msg = fmt.Sprintf("flag redefined: %s", name)
		} else {
			msg = fmt.Sprintf("%s flag redefined: %s", f.name, name)
		}
		fmt.Fprintln(f.Output(), msg)
		panic(msg) // Happens only if flags are declared with identical names
	}
	if f.formal == nil {
		f.formal = make(map[string]*Flag)
	}
	f.formal[name] = flag
}


Var 是注册的核心方法. 经过几层代理, 默认值已经设置到 value 中, name 是标签名, usage 是帮助信息, 他们被包装到 Flag 结构体内, 保存到 FlagSet 的 formal 里.

formal 是个 map, 标签名作为 map 的键, 不允许重复注册, 否则抛 panic .

解析标签

func (f *FlagSet) parseOne() (bool, error) {
	//...
	flag.Value.Set(value)
	//...
}


Parse() 方法内循环调用 parseOne(), 每成功解析完一对参数, FlagSet 的 args 就被截断一截, 直到解析结束, args 也被截空了.

一旦解析出错, 就按照 FlagSet 中 errorHandling 的规则处理, 默认是 exit(2) 退出程序.

成功解析的参数经由 	flag.Value.Set(value) 被设置为对应的值.
" />
    <meta property="og:description" content="flag 是官方提供的命令行参数解析的工具包.

基本用法

package main

import (
	"flag"
	"fmt"
)

var name = flag.String("name", "Default Name", "Name setting")

func main() {
	flag.Parse()
	fmt.Printf("Hello %s\n", *name)
}
// go run main.go -name=John
// go run main.go -name="John smith"


自定义解析器

package main

import (
	"flag"
	"fmt"
	"github.com/spf13/cast"
	"strings"
)

type User struct {
	Name string
	Age  int
}

func (u *User) String() string {
	return fmt.Sprintf("Name:%s, Age:%d\n", u.Name, u.Age)
}

// Set by Bob:12
func (u *User) Set(value string) error {
	splits := strings.Split(value, ":")
	if len(splits) == 2 {
		u.Name = splits[0]
		u.Age = cast.ToInt(splits[1])
		return nil
	}
	return fmt.Errorf("format error")
}

func FlagUser(name string, value string, usage string) *User {
	u := User{}
	_ = u.Set(value) // init default value
	flag.Var(&amp;u, name, usage)
	return &amp;u
}

var u = FlagUser("user", "Default Name:100", "parse User")

func main() {
	flag.Parse()
	fmt.Printf("%T %s\n", u, u)
}
// go run main.go -user=Bob:12



核心方法是 func (f *FlagSet) Var(value Value, name string, usage string), Value 的接口如下所示:

type Value interface {
	String() string
	Set(string) error
}


对于解析参数来说, 我们用不到 String(), 但是在语法上要实现这个接口就要实现 String() 方法.

还需要注意实现 String() 的时候不要直接return fmt.Sprintln(u), 否则会导致方法无限递归而 stack overflow.

FlagUser 参照了 flag 自带方法的风格, 参数依次为 flag值, 默认值, 帮助提示, 最后返回一个自定义类型的指针.

源码解析

在开始读源码之前, 我们先看一下 os.Args 的解析规则, 它会得到一个字符串 slice.

package main

import (
	"fmt"
	"os"
)

func main() {
	for _, s := range os.Args {
		fmt.Println(s)
	}
}


$ go run main.go  --s -s hello -s=hi --s="hello world"


output:

/var/folders/jd/tgbfgqzn3z1c_qmcd0qcmcx80000gn/T/go-build687856139/b001/exe/main
--s
-s
hello
-s=hi
--s=hello world



规则要点如下:


  每个元素都是字符串, 大小写敏感;
  第一个元素为该程序的绝对路径;
  后面的元素依次为空格分隔的参数, 连续空格视作一个分隔;
  引号内的空格不做分隔, 自动脱去引号.


flag 在以上规则的基础上, 衍生出以下规则:


  参数由 - 或 --开始, 用等号或空格分隔键值, --s=1, -s=1, --s 1, -s 1 等效;
  -s -S 为不同的标签;
  对于布尔型的标签, 可以略去值来表示标签为 true: -b, --b;
  ` – ` 后的参数将被忽略;
  不允许重复注册标签.


核心结构体

像 flag 这样先注册再使用的模式(类似路由匹配), 一般会在注册时解析规则, 然后把规则保存到一个集合里, 在使用的时候去集合里匹配规则.

FlagSet 就是这样的一个集合, Flag 是其中的每个元素.

type Flag struct {
	Name     string // 标签名: `-s` 或 `--s` 中 的 `s`
	Usage    string // 用途, 帮助信息.
	Value    Value  // Value 接口: `Set(v string) error` &amp;&amp; `String() string`
	DefValue string // 标签的默认值, 为打印帮助信息所用.
}


type FlagSet struct {
	Usage func()	// 帮助信息的打印函数, 默认为 `defaultUsage()`

	name          string // 当前程序的绝对路径
	parsed        bool // 标记已经执行过解析: `flag.Parse()`
	actual        map[string]*Flag // 由 `os.Args` 解析得到的标签
	formal        map[string]*Flag // 之前注册的标签
	args          []string // 命令行参数列表 (除去程序的绝对路径)
	errorHandling ErrorHandling // 异常处理的方式: 返回 error / 程序 exit / panic
	output        io.Writer // 打印目的地, 默认为 `os.Stderr`
}


注册标签

var CommandLine = NewFlagSet(os.Args[0], ExitOnError)


CommandLine 是 package 级别的, 只会运行一次 NewFlagSet(), 得到的结果指向一个未完全初始化的 FlagSet (map 和 slice 现在还是空).

func (f *FlagSet) Var(value Value, name string, usage string) {
	// Remember the default value as a string; it won't change.
	flag := &amp;Flag{name, usage, value, value.String()}
	_, alreadythere := f.formal[name]
	if alreadythere {
		var msg string
		if f.name == "" {
			msg = fmt.Sprintf("flag redefined: %s", name)
		} else {
			msg = fmt.Sprintf("%s flag redefined: %s", f.name, name)
		}
		fmt.Fprintln(f.Output(), msg)
		panic(msg) // Happens only if flags are declared with identical names
	}
	if f.formal == nil {
		f.formal = make(map[string]*Flag)
	}
	f.formal[name] = flag
}


Var 是注册的核心方法. 经过几层代理, 默认值已经设置到 value 中, name 是标签名, usage 是帮助信息, 他们被包装到 Flag 结构体内, 保存到 FlagSet 的 formal 里.

formal 是个 map, 标签名作为 map 的键, 不允许重复注册, 否则抛 panic .

解析标签

func (f *FlagSet) parseOne() (bool, error) {
	//...
	flag.Value.Set(value)
	//...
}


Parse() 方法内循环调用 parseOne(), 每成功解析完一对参数, FlagSet 的 args 就被截断一截, 直到解析结束, args 也被截空了.

一旦解析出错, 就按照 FlagSet 中 errorHandling 的规则处理, 默认是 exit(2) 退出程序.

成功解析的参数经由 	flag.Value.Set(value) 被设置为对应的值.
" />
    
    <meta name="author" content="CBD Blog" />

    
    <meta property="og:title" content="Go Lib flag" />
    <meta property="twitter:title" content="Go Lib flag" />
    
  <link rel="stylesheet" type="text/css" href="/style.css" />
  <link rel="alternate" type="application/rss+xml" title="CBD Blog - 好记性不如烂笔头,站在岸上学不会游泳" href="/feed.xml" />
  <link rel="shortcut icon" href="/images/avatar.jpg">
<!--  <script src="https://lib.baomitu.com/gitalk/1.6.2/gitalk.min.js"></script>-->
  <script src="https://lib.baomitu.com/feather-icons/latest/feather.min.js"></script>
  <script type="text/javascript" async src="https://lib.baomitu.com/mathjax/2.7.7/MathJax.js?...">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$','$']]
      }
    });
  </script>
  <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?9dfbb5850b35a184a60c9a4a1b08d7e3";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

  <meta name="google-site-verification" content="ZqVpjmLHnwuJ0qbh4QrpcofglQe6XEjjF7X1AB7yXus" />
</head>

  <body>
    <div class="wrapper-sidebar">
  <header class="sidebar clearfix">
    <div class="site-info">
      
        <a href="/" class="site-avatar"><img src="/images/avatar.jpg" /></a>
       
      <h1 class="site-name"><a href="/">CBD Blog</a></h1>
      <p class="site-description">好记性不如烂笔头,站在岸上学不会游泳</p>
    </div>
  </header>

  <div class="navlist">
    <nav>
      
      
      <a href="/">首页</a>
      
      
      
      <a href="/archive">归档</a>
      
      
      
      <a href="/about">关于</a>
      
      
    </nav>
  </div>

  <div class="wrapper-footer-desktop">
    <footer class="footer">
      <!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  
  
  

  

  
  <li><a href="mailto:wwwicbd@gmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/icbd" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  
  <li><a href="/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://www.twitter.com/CbdFocus" class="icon-26 twitter" title="Twitter"><svg viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li>
  

  

</ul>



<p>Copyright (c) 2020 CBD Blog</p>

    </footer>
  </div>
</div>

    
      <aside class="toc">
        <ul>
  <li><a href="#">Go Lib flag</a>
    <ul>
      <li><a href="#基本用法">基本用法</a></li>
      <li><a href="#自定义解析器">自定义解析器</a></li>
      <li><a href="#源码解析">源码解析</a>
        <ul>
          <li><a href="#核心结构体">核心结构体</a></li>
          <li><a href="#注册标签">注册标签</a></li>
          <li><a href="#解析标签">解析标签</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
      </aside>
    

    <div id="main" role="main" class="wrapper-content">
      <div class="container">
        <article class="posts">
  <h1>Go Lib flag</h1>

  <div clsss="meta">
    <span class="author">
      
    </span>

    <span class="date">
      2020-10-19
    </span>

    <ul class="tag">
      
      <li>
        <a href="https://icbd.github.io/tags#Golang">
          Golang
        </a>
      </li>
      
      <li>
        <a href="https://icbd.github.io/tags#Lib">
          Lib
        </a>
      </li>
      
    </ul>
  </div>

  <div class="entry">
    <p><code class="language-plaintext highlighter-rouge">flag</code> 是官方提供的命令行参数解析的工具包.</p>

<h2 id="基本用法">基本用法</h2>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"flag"</span>
	<span class="s">"fmt"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">name</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"Default Name"</span><span class="p">,</span> <span class="s">"Name setting"</span><span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Hello %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// go run main.go -name=John</span>
<span class="c">// go run main.go -name="John smith"</span>
</code></pre></div></div>

<h2 id="自定义解析器">自定义解析器</h2>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"flag"</span>
	<span class="s">"fmt"</span>
	<span class="s">"github.com/spf13/cast"</span>
	<span class="s">"strings"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">User</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Name</span> <span class="kt">string</span>
	<span class="n">Age</span>  <span class="kt">int</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span><span class="n">User</span><span class="p">)</span> <span class="n">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"Name:%s, Age:%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">Age</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// Set by Bob:12</span>
<span class="k">func</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span><span class="n">User</span><span class="p">)</span> <span class="n">Set</span><span class="p">(</span><span class="n">value</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="n">splits</span> <span class="o">:=</span> <span class="n">strings</span><span class="o">.</span><span class="n">Split</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">":"</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span> <span class="o">==</span> <span class="m">2</span> <span class="p">{</span>
		<span class="n">u</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="m">0</span><span class="p">]</span>
		<span class="n">u</span><span class="o">.</span><span class="n">Age</span> <span class="o">=</span> <span class="n">cast</span><span class="o">.</span><span class="n">ToInt</span><span class="p">(</span><span class="n">splits</span><span class="p">[</span><span class="m">1</span><span class="p">])</span>
		<span class="k">return</span> <span class="no">nil</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"format error"</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">FlagUser</span><span class="p">(</span><span class="n">name</span> <span class="kt">string</span><span class="p">,</span> <span class="n">value</span> <span class="kt">string</span><span class="p">,</span> <span class="n">usage</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="n">User</span> <span class="p">{</span>
	<span class="n">u</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{}</span>
	<span class="n">_</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="c">// init default value</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Var</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">usage</span><span class="p">)</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">u</span>
<span class="p">}</span>

<span class="k">var</span> <span class="n">u</span> <span class="o">=</span> <span class="n">FlagUser</span><span class="p">(</span><span class="s">"user"</span><span class="p">,</span> <span class="s">"Default Name:100"</span><span class="p">,</span> <span class="s">"parse User"</span><span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Parse</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"%T %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// go run main.go -user=Bob:12</span>

</code></pre></div></div>

<p>核心方法是 <code class="language-plaintext highlighter-rouge">func (f *FlagSet) Var(value Value, name string, usage string)</code>, <code class="language-plaintext highlighter-rouge">Value</code> 的接口如下所示:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Value</span> <span class="k">interface</span> <span class="p">{</span>
	<span class="n">String</span><span class="p">()</span> <span class="kt">string</span>
	<span class="n">Set</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
<span class="p">}</span>
</code></pre></div></div>

<p>对于解析参数来说, 我们用不到 <code class="language-plaintext highlighter-rouge">String()</code>, 但是在语法上要实现这个接口就要实现 <code class="language-plaintext highlighter-rouge">String()</code> 方法.</p>

<p>还需要注意实现 <code class="language-plaintext highlighter-rouge">String()</code> 的时候不要直接<code class="language-plaintext highlighter-rouge">return fmt.Sprintln(u)</code>, 否则会导致方法无限递归而 stack overflow.</p>

<p><code class="language-plaintext highlighter-rouge">FlagUser</code> 参照了 <code class="language-plaintext highlighter-rouge">flag</code> 自带方法的风格, 参数依次为 flag值, 默认值, 帮助提示, 最后返回一个自定义类型的指针.</p>

<h2 id="源码解析">源码解析</h2>

<p>在开始读源码之前, 我们先看一下 <code class="language-plaintext highlighter-rouge">os.Args</code> 的解析规则, 它会得到一个字符串 slice.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"os"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">s</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">os</span><span class="o">.</span><span class="n">Args</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>go run main.go  <span class="nt">--s</span> <span class="nt">-s</span> hello <span class="nt">-s</span><span class="o">=</span>hi <span class="nt">--s</span><span class="o">=</span><span class="s2">"hello world"</span>
</code></pre></div></div>

<p>output:</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/var/folders/jd/tgbfgqzn3z1c_qmcd0qcmcx80000gn/T/go-build687856139/b001/exe/main
--s
-s
hello
-s=hi
--s=hello world

</code></pre></div></div>

<p>规则要点如下:</p>

<ul>
  <li>每个元素都是字符串, 大小写敏感;</li>
  <li>第一个元素为该程序的绝对路径;</li>
  <li>后面的元素依次为空格分隔的参数, 连续空格视作一个分隔;</li>
  <li>引号内的空格不做分隔, 自动脱去引号.</li>
</ul>

<p>flag 在以上规则的基础上, 衍生出以下规则:</p>

<ul>
  <li>参数由 <code class="language-plaintext highlighter-rouge">-</code> 或 <code class="language-plaintext highlighter-rouge">--</code>开始, 用等号或空格分隔键值, <code class="language-plaintext highlighter-rouge">--s=1</code>, <code class="language-plaintext highlighter-rouge">-s=1</code>, <code class="language-plaintext highlighter-rouge">--s 1</code>, <code class="language-plaintext highlighter-rouge">-s 1</code> 等效;</li>
  <li><code class="language-plaintext highlighter-rouge">-s</code> <code class="language-plaintext highlighter-rouge">-S</code> 为不同的标签;</li>
  <li>对于布尔型的标签, 可以略去值来表示标签为 true: <code class="language-plaintext highlighter-rouge">-b</code>, <code class="language-plaintext highlighter-rouge">--b</code>;</li>
  <li>` – ` 后的参数将被忽略;</li>
  <li>不允许重复注册标签.</li>
</ul>

<h3 id="核心结构体">核心结构体</h3>

<p>像 flag 这样先注册再使用的模式(类似路由匹配), 一般会在注册时解析规则, 然后把规则保存到一个集合里, 在使用的时候去集合里匹配规则.</p>

<p><code class="language-plaintext highlighter-rouge">FlagSet</code> 就是这样的一个集合, <code class="language-plaintext highlighter-rouge">Flag</code> 是其中的每个元素.</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Flag</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Name</span>     <span class="kt">string</span> <span class="c">// 标签名: `-s` 或 `--s` 中 的 `s`</span>
	<span class="n">Usage</span>    <span class="kt">string</span> <span class="c">// 用途, 帮助信息.</span>
	<span class="n">Value</span>    <span class="n">Value</span>  <span class="c">// Value 接口: `Set(v string) error` &amp;&amp; `String() string`</span>
	<span class="n">DefValue</span> <span class="kt">string</span> <span class="c">// 标签的默认值, 为打印帮助信息所用.</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">FlagSet</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">Usage</span> <span class="k">func</span><span class="p">()</span>	<span class="c">// 帮助信息的打印函数, 默认为 `defaultUsage()`</span>

	<span class="n">name</span>          <span class="kt">string</span> <span class="c">// 当前程序的绝对路径</span>
	<span class="n">parsed</span>        <span class="kt">bool</span> <span class="c">// 标记已经执行过解析: `flag.Parse()`</span>
	<span class="n">actual</span>        <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">Flag</span> <span class="c">// 由 `os.Args` 解析得到的标签</span>
	<span class="n">formal</span>        <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">Flag</span> <span class="c">// 之前注册的标签</span>
	<span class="n">args</span>          <span class="p">[]</span><span class="kt">string</span> <span class="c">// 命令行参数列表 (除去程序的绝对路径)</span>
	<span class="n">errorHandling</span> <span class="n">ErrorHandling</span> <span class="c">// 异常处理的方式: 返回 error / 程序 exit / panic</span>
	<span class="n">output</span>        <span class="n">io</span><span class="o">.</span><span class="n">Writer</span> <span class="c">// 打印目的地, 默认为 `os.Stderr`</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="注册标签">注册标签</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">CommandLine</span> <span class="o">=</span> <span class="n">NewFlagSet</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">ExitOnError</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">CommandLine</code> 是 package 级别的, 只会运行一次 <code class="language-plaintext highlighter-rouge">NewFlagSet()</code>, 得到的结果指向一个未完全初始化的 <code class="language-plaintext highlighter-rouge">FlagSet</code> (map 和 slice 现在还是空).</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">FlagSet</span><span class="p">)</span> <span class="n">Var</span><span class="p">(</span><span class="n">value</span> <span class="n">Value</span><span class="p">,</span> <span class="n">name</span> <span class="kt">string</span><span class="p">,</span> <span class="n">usage</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// Remember the default value as a string; it won't change.</span>
	<span class="n">flag</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">Flag</span><span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">String</span><span class="p">()}</span>
	<span class="n">_</span><span class="p">,</span> <span class="n">alreadythere</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">formal</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">alreadythere</span> <span class="p">{</span>
		<span class="k">var</span> <span class="n">msg</span> <span class="kt">string</span>
		<span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"flag redefined: %s"</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s flag redefined: %s"</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Fprintln</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Output</span><span class="p">(),</span> <span class="n">msg</span><span class="p">)</span>
		<span class="nb">panic</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="c">// Happens only if flags are declared with identical names</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">formal</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">f</span><span class="o">.</span><span class="n">formal</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="n">Flag</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">f</span><span class="o">.</span><span class="n">formal</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Var</code> 是注册的核心方法. 经过几层代理, 默认值已经设置到 <code class="language-plaintext highlighter-rouge">value</code> 中, <code class="language-plaintext highlighter-rouge">name</code> 是标签名, <code class="language-plaintext highlighter-rouge">usage</code> 是帮助信息, 他们被包装到 <code class="language-plaintext highlighter-rouge">Flag</code> 结构体内, 保存到 <code class="language-plaintext highlighter-rouge">FlagSet</code> 的 <code class="language-plaintext highlighter-rouge">formal</code> 里.</p>

<p><code class="language-plaintext highlighter-rouge">formal</code> 是个 map, 标签名作为 map 的键, 不允许重复注册, 否则抛 panic .</p>

<h3 id="解析标签">解析标签</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">FlagSet</span><span class="p">)</span> <span class="n">parseOne</span><span class="p">()</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">//...</span>
	<span class="n">flag</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	<span class="c">//...</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Parse()</code> 方法内循环调用 <code class="language-plaintext highlighter-rouge">parseOne()</code>, 每成功解析完一对参数, <code class="language-plaintext highlighter-rouge">FlagSet</code> 的 <code class="language-plaintext highlighter-rouge">args</code> 就被截断一截, 直到解析结束, <code class="language-plaintext highlighter-rouge">args</code> 也被截空了.</p>

<p>一旦解析出错, 就按照 <code class="language-plaintext highlighter-rouge">FlagSet</code> 中 <code class="language-plaintext highlighter-rouge">errorHandling</code> 的规则处理, 默认是 <code class="language-plaintext highlighter-rouge">exit(2)</code> 退出程序.</p>

<p>成功解析的参数经由 	<code class="language-plaintext highlighter-rouge">flag.Value.Set(value)</code> 被设置为对应的值.</p>

  </div>

  
  
<script src="https://utteranc.es/client.js"
        repo="icbd/blogs"
        issue-term="pathname"
        label="utteranc"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

  
</article>

<div class="pagination">
  
    <span class="prev" >
      <a href="https://icbd.github.io/go-lib-ratelimit/">
        ← 上一篇
      </a>
    </span>
  
  
    <span class="next" >
      <a href="https://icbd.github.io/golang-fragment/">
        下一篇 →
      </a>
    </span>
  
</div>

      </div>
    </div>
  </body>

  
  <script>
    document.getElementById("main").classList.add("withtoc");
  </script>
  

  <div class="wrapper-footer-mobile">
    <footer class="footer">
      <!-- Refer to https://codepen.io/ruandre/pen/howFi -->
<ul class="svg-icon">

  
  
  

  

  
  <li><a href="mailto:wwwicbd@gmail.com" class="icon-8 email" title="Email"><svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg><!--[if lt IE 9]><em>Email</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://github.com/icbd" class="icon-13 github" title="GitHub"><svg viewBox="0 0 512 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg><!--[if lt IE 9]><em>GitHub</em><![endif]--></a></li>
  

  

  

  

  
  <li><a href="/feed.xml" class="icon-21 rss" title="RSS"><svg viewBox="0 0 512 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg><!--[if lt IE 9]><em>RSS</em><![endif]--></a></li>
  

  

  

  
  <li><a href="https://www.twitter.com/CbdFocus" class="icon-26 twitter" title="Twitter"><svg viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg><!--[if lt IE 9]><em>Twitter</em><![endif]--></a></li>
  

  

</ul>



<p>Copyright (c) 2020 CBD Blog</p>

    </footer>
</html>
